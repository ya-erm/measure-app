(this["webpackJsonpmeasure-app"]=this["webpackJsonpmeasure-app"]||[]).push([[0],{15:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},22:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(5),l=n.n(i),c=(n(15),n(6)),a=(n(19),n(4)),u=n(10);var s=o.a.createContext(null),f=function(){var e=o.a.useContext(s);if(null===e)throw new Error("useGlobalContext must be used within an GlobalContext.Provider");return e},d=(n(20),n(1)),p=function(){var e=f(),t=e.globalState,n=t.stylusMode,r=t.magneticMode,o=t.wallAlignmentMode,i=e.updateGlobalState;return Object(d.jsxs)("div",{className:"settingsList",children:[Object(d.jsx)("div",{children:Object(d.jsxs)("label",{children:[Object(d.jsx)("input",{type:"checkbox",checked:null!==n&&void 0!==n&&n,onChange:function(e){return i({stylusMode:e.target.checked})}}),"\u0420\u0435\u0436\u0438\u043c \u0441\u0442\u0438\u043b\u0443\u0441\u0430"]})}),Object(d.jsx)("div",{children:Object(d.jsxs)("label",{children:[Object(d.jsx)("input",{type:"checkbox",checked:null!==o&&void 0!==o&&o,onChange:function(e){return i({wallAlignmentMode:e.target.checked})}}),"\u0420\u043e\u0432\u043d\u044b\u0435 \u0441\u0442\u0435\u043d\u044b"]})}),Object(d.jsx)("div",{children:Object(d.jsxs)("label",{children:[Object(d.jsx)("input",{type:"checkbox",checked:null!==r&&void 0!==r&&r,onChange:function(e){return i({magneticMode:e.target.checked})}}),"\u041f\u0440\u0438\u0432\u044f\u0437\u043a\u0430 \u043a \u0441\u0442\u0435\u043d\u0430\u043c"]})})]})};function h(e,t,n,r,o){e.fillStyle=o,e.fillRect(t-r/2,n-r/2,r,r)}function v(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.stroke()}var b=30;function g(e,t){h(e,t.p1.x,t.p1.y,10,"green")}function y(e,t){h(e,t.p2.x,t.p2.y,10,"red")}function x(e,t){v(e,t.p1.x,t.p1.y,b),v(e,t.p2.x,t.p2.y,b),function(e,t,n,r,o){e.beginPath(),e.moveTo(t,n),e.lineTo(r,o),e.stroke()}(e,t.p1.x,t.p1.y,t.p2.x,t.p2.y),g(e,t),y(e,t)}function w(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,o=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",e.moveTo(t,n),e.arc(t,n,r,0,2*Math.PI,!1),e.fill(),e.globalCompositeOperation=o}function j(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function O(e,t,n,r){function o(e){return{id:1,x:e.pageX,y:e.pageY,type:"mouse",buttons:e.buttons,changedTouches:[{identifier:1,pageX:e.pageX,pageY:e.pageY}]}}var i=function(e){return t(o(e))},l=function(e){return n(o(e))},c=function(e){return r(o(e))};function a(e){var t=e.changedTouches[0];return{id:t.identifier,x:t.pageX,y:t.pageY,touches:Array.from(e.touches),changedTouches:Array.from(e.changedTouches),type:"stylus"===t.touchType?"stylus":"touch"}}var u=function(e){return t(a(e))},s=function(e){return n(a(e))},f=function(e){return r(a(e))};return e.addEventListener("mousedown",i),e.addEventListener("mousemove",l),e.addEventListener("mouseup",c),e.addEventListener("touchstart",u),e.addEventListener("touchmove",s),e.addEventListener("touchend",f),function(){e.removeEventListener("mousedown",i),e.removeEventListener("mousemove",l),e.removeEventListener("mouseup",c),e.removeEventListener("touchstart",u),e.removeEventListener("touchmove",s),e.removeEventListener("touchend",f)}}var m,E=function(){var e=f(),t=e.globalState,n=e.updateGlobalState,o=t.scale,i=t.canvas,l=t.context,c=t.stylusMode,a=t.magneticMode,u=t.selectedTool,s=t.plan;return Object(r.useEffect)((function(){if(i&&"cursor"===u){var e=window.innerWidth*o,t=window.innerHeight*o,r=function(){l.clearRect(0,0,e,t),s.walls.forEach((function(e){x(l,e)}))};return O(i,(function(e){var t;c&&"touch"===e.type||(n({pointerDown:!0}),null===(t=e.changedTouches)||void 0===t||t.forEach((function(e){var t=e.identifier,n=e.pageX*o,r=e.pageY*o;s.walls.flatMap((function(e){return[e.p1,e.p2]})).filter((function(e){return j(e,{x:n,y:r})<=b})).forEach((function(e){e.editId=t}))})))}),(function(e){var t;("mouse"!==e.type||e.buttons)&&(null===(t=e.changedTouches)||void 0===t||t.forEach((function(e){var t=e.identifier,n=e.pageX*o,r=e.pageY*o;s.walls.flatMap((function(e){return[e.p1,e.p2]})).filter((function(e){return e.editId===t})).forEach((function(e){e.x=n,e.y=r}))})),r())}),(function(e){var t,o;null===(t=e.changedTouches)||void 0===t||t.forEach((function(e){var t=e.identifier;s.walls.flatMap((function(e){return[e.p1,e.p2]})).filter((function(e){return e.editId===t})).forEach((function(e){if(e.editId=void 0,a){var t=s.walls.flatMap((function(e){return[e.p1,e.p2]})).filter((function(t){return t!==e&&t.x!==e.x&&t.y!==e.y})).find((function(t){return j(t,e)<=b}));t&&(e.x=t.x,e.y=t.y)}}))})),r(),0===(null===(o=e.touches)||void 0===o?void 0:o.length)&&n({pointerDown:!1})}))}}),[i,l,o,c,a,u]),null},M=function(){var e=f(),t=e.globalState,n=e.updateGlobalState,o=t.scale,i=t.canvas,l=t.context,c=t.stylusMode,a=t.magneticMode,u=t.selectedTool,s=Object(r.useRef)(null),p=window.innerWidth*o,h=window.innerHeight*o;return Object(r.useEffect)((function(){s.current.width=p,s.current.height=h}),[]),Object(r.useEffect)((function(){if(i&&("pen"===u||"eraser"===u)){var e=0,t=[],r=s.current.getContext("2d");return O(i,(function(i){var l,a;if((!c||"touch"!==i.type)&&!("touch"===i.type&&i.touches.length>1)){n({pointerDown:!0});var s=i.touches&&i.touches[0],f=(null!==(l=null===s||void 0===s?void 0:s.pageX)&&void 0!==l?l:i.x)*o,d=(null!==(a=null===s||void 0===s?void 0:s.pageY)&&void 0!==a?a:i.y)*o;e=40*Math.log(((null===s||void 0===s?void 0:s.force)||.1)+1),"pen"===u?(r.lineWidth=e,t.push({x:f,y:d,lineWidth:e})):w(r,f,d,3*e)}}),(function(n){var i,l,a;if((!c||"touch"!==n.type)&&("mouse"!==n.type||n.buttons)){var s=n.touches&&n.touches[0],f=(null!==(i=null===s||void 0===s?void 0:s.pageX)&&void 0!==i?i:n.x)*o,d=(null!==(l=null===s||void 0===s?void 0:s.pageY)&&void 0!==l?l:n.y)*o;e=40*Math.log(((null===s||void 0===s?void 0:s.force)||.1)+1)*.2+.8*(null!==(a=e)&&void 0!==a?a:0),"pen"===u?(t.push({x:f,y:d,lineWidth:e}),function(e,t){e.strokeStyle="black",e.lineCap="round",e.lineJoin="round";var n=t.length-1;if(t.length>=3){var r=(t[n].x+t[n-1].x)/2,o=(t[n].y+t[n-1].y)/2;e.lineWidth=t[n-1].lineWidth,e.quadraticCurveTo(t[n-1].x,t[n-1].y,r,o),e.stroke(),e.beginPath(),e.moveTo(r,o)}else{var i=t[n];e.lineWidth=i.lineWidth,i.color&&(e.strokeStyle=i.color),e.beginPath(),e.moveTo(i.x,i.y),e.stroke()}}(r,t)):w(r,f,d,3*e)}}),(function(r){t=[],e=0,r.touches&&0!==r.touches.length||n({pointerDown:!1})}))}}),[i,l,o,c,a,u]),Object(d.jsx)("canvas",{ref:s,className:"fullScreenCanvas"})},L=n(9),C=["title","titleId"];function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function k(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function I(e,t){var n=e.title,o=e.titleId,i=k(e,C);return r.createElement("svg",S({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":o},i),n?r.createElement("title",{id:o},n):null,m||(m=r.createElement("path",{d:"M3,16H12V21H3V16M2,10H8V15H2V10M9,10H15V15H9V10M16,10H22V15H16V10M13,16H21V21H13V16M3,4H11V9H3V4M12,4H21V9H12V4Z"})))}var P,T=r.forwardRef(I),H=(n.p,["title","titleId"]);function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function X(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function W(e,t){var n=e.title,o=e.titleId,i=X(e,H);return r.createElement("svg",V({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":o},i),n?r.createElement("title",{id:o},n):null,P||(P=r.createElement("path",{d:"M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})))}var D,G=r.forwardRef(W),R=(n.p,["title","titleId"]);function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Y(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function B(e,t){var n=e.title,o=e.titleId,i=Y(e,R);return r.createElement("svg",A({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":o},i),n?r.createElement("title",{id:o},n):null,D||(D=r.createElement("path",{d:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"})))}var N,F=r.forwardRef(B),Z=(n.p,["title","titleId"]);function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function q(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function z(e,t){var n=e.title,o=e.titleId,i=q(e,Z);return r.createElement("svg",J({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":o},i),n?r.createElement("title",{id:o},n):null,N||(N=r.createElement("path",{d:"M16.24,3.56L21.19,8.5C21.97,9.29 21.97,10.55 21.19,11.34L12,20.53C10.44,22.09 7.91,22.09 6.34,20.53L2.81,17C2.03,16.21 2.03,14.95 2.81,14.16L13.41,3.56C14.2,2.78 15.46,2.78 16.24,3.56M4.22,15.58L7.76,19.11C8.54,19.9 9.8,19.9 10.59,19.11L14.12,15.58L9.17,10.63L4.22,15.58Z"})))}var K=r.forwardRef(z),Q=(n.p,n(22),function(){var e=f(),t=e.globalState.selectedTool,n=e.updateGlobalState,r=function(e){var r=e.type,o=e.name,i=e.icon;return Object(d.jsx)("div",{onClick:function(){n({selectedTool:r})},className:Object(L.a)("toolboxItem",t===r&&"toolboxSelectedItem"),children:null!==i&&void 0!==i?i:o})};return Object(d.jsxs)("div",{className:"toolboxContainer",children:[Object(d.jsx)(r,{type:"wall",name:"\u0421\u0442\u0435\u043d\u0430",icon:Object(d.jsx)(T,{})}),Object(d.jsx)(r,{type:"cursor",name:"\u041a\u0443\u0440\u0441\u043e\u0440",icon:Object(d.jsx)(G,{})}),Object(d.jsx)(r,{type:"pen",name:"\u041a\u0430\u0440\u0430\u043d\u0434\u0430\u0448",icon:Object(d.jsx)(F,{})}),Object(d.jsx)(r,{type:"eraser",name:"\u041b\u0430\u0441\u0442\u0438\u043a",icon:Object(d.jsx)(K,{})})]})}),U=function(){var e=f(),t=e.globalState,n=e.updateGlobalState,o=t.scale,i=t.canvas,l=t.context,c=t.stylusMode,a=t.magneticMode,u=t.wallAlignmentMode,s=t.selectedTool,p=t.plan,h=Object(r.useRef)(null),v=window.innerWidth*o,w=window.innerHeight*o;return Object(r.useEffect)((function(){h.current.width=v,h.current.height=w}),[]),Object(r.useEffect)((function(){if(i&&"wall"===s){var e=h.current.getContext("2d"),t=function(){e.clearRect(0,0,v,w),p.walls.filter((function(e){return e.editId})).forEach((function(t){x(e,t)}))};return O(i,(function(r){var i=r.x*o,l=r.y*o;if(!c||"touch"!==r.type)if("touch"===r.type&&r.touches.length>1)!function(e){var n=p.walls.findIndex((function(t){return t.editId===e}));n>=0&&(p.walls.splice(n,1),t())}(r.id);else{n({pointerDown:!0});var u={editId:r.id,p1:{x:i,y:l},p2:{x:i,y:l}};if(a){var s=p.walls.flatMap((function(e){return[e.p1,e.p2]})).find((function(e){return j(e,u.p1)<=b}));s&&(u.p1.x=s.x,u.p1.y=s.y,u.p2.x=s.x,u.p2.y=s.y)}p.walls.push(u),g(e,u)}}),(function(e){if("mouse"!==e.type||e.buttons){var n=e.x*o,r=e.y*o,i=p.walls.find((function(t){return t.editId===e.id}));i&&(i.p2.x=n,i.p2.y=r,u&&("horizontal"===function(e){var t=e.p1,n=e.p2,r=n.x-t.x,o=n.y-t.y;return Math.abs(r)>Math.abs(o)?"horizontal":"vertical"}({p1:i.p1,p2:{x:n,y:r}})?i.p2.y=i.p1.y:i.p2.x=i.p1.x),t())}}),(function(e){var r=e.id,o=e.touches,i=p.walls.find((function(e){return e.editId===r}));if(i){if(i.editId=void 0,a){var c=p.walls.filter((function(e){return e!==i})).flatMap((function(e){return[e.p1,e.p2]})).find((function(e){return j(e,i.p2)<=b}));c&&(i.p2.x=c.x,i.p2.y=c.y)}t(),y(l,i),x(l,i)}0===(null===o||void 0===o?void 0:o.length)&&n({pointerDown:!1})}))}}),[i,l,c,a,u,s]),Object(d.jsx)("canvas",{ref:h,className:"fullScreenCanvas"})};var $=function(){var e=function(){var e=Object(r.useState)({scale:2,selectedTool:"wall",pointerDown:!1,stylusMode:!0,magneticMode:!0,wallAlignmentMode:!0,plan:{walls:[]}}),t=Object(u.a)(e,2),n=t[0],o=t[1],i=Object(r.useCallback)((function(e){return o((function(t){return Object(a.a)(Object(a.a)({},t),e)}))}),[]);return{globalState:n,setGlobalState:o,updateGlobalState:i}}(),t=e.globalState,n=e.updateGlobalState,o=t.scale,i=t.pointerDown,l=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=function(e){i&&e.preventDefault()};return document.addEventListener("touchmove",e,{passive:!1}),function(){document.removeEventListener("touchmove",e)}}),[i]),Object(r.useEffect)((function(){var e=l.current;e.width=window.innerWidth*o,e.height=window.innerHeight*o;var t=e.getContext("2d");n({canvas:e,context:t})}),[o,n]),Object(d.jsx)(s.Provider,{value:e,children:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(c.a,{children:Object(d.jsx)("title",{children:"Measure App"})}),Object(d.jsxs)("main",{children:[Object(d.jsx)(M,{}),Object(d.jsx)(U,{}),Object(d.jsx)(E,{}),Object(d.jsx)("canvas",{ref:l,className:"fullScreenCanvas"}),Object(d.jsx)(Q,{}),Object(d.jsx)(p,{})]})]})})},_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,24)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,l=t.getTTFB;n(e),r(e),o(e),i(e),l(e)}))};l.a.render(Object(d.jsx)(o.a.StrictMode,{children:Object(d.jsx)($,{})}),document.getElementById("root")),_()}},[[23,1,2]]]);
//# sourceMappingURL=main.d74c7423.chunk.js.map